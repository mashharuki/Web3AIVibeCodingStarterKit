# AMM DEX 開発タスクリスト (プロフェッショナル版)

このドキュメントは、[AMM DEX 要件定義書](./amm_dex_requirements.md)とプロフェッショナルレビューに基づき、開発に必要なタスクをフェーズごとに洗い出したものです。

---

## フェーズ1: プロジェクト基盤構築 (変更なし)

- [ ] **1.1. Monorepo環境のセットアップ**
    - [ ] pnpm-workspace.yaml を設定し、`pkgs/contract` と `pkgs/frontend` のワークスペースを定義する。
    - [ ] ルートに `package.json` を作成し、共通の開発依存パッケージ（TypeScript, Biome）を導入する。
    - [ ] ルートに `biome.json` を設定する。
    - [ ] ルートに `.gitignore` を設定する。

- [ ] **1.2. スマートコントラクト開発環境の構築 (`pkgs/contract`)**
    - [ ] Hardhatプロジェクトを初期化する。
    - [ ] 要件定義に基づき、`hardhat.config.ts` を設定する。
    - [ ] 必要なライブラリ（`@openzeppelin/contracts`, `hardhat-gas-reporter`, `solhint`等）をインストールする。
    - [ ] `.solhint.json` と `.solhintignore` を設定する。
    - [ ] `.env.example` を作成し、必要な環境変数（`PRIVATE_KEY`, `ALCHEMY_API_KEY`等）を定義する。

- [ ] **1.3. フロントエンド開発環境の構築 (`pkgs/frontend`)**
    - [ ] Next.js (App Router) プロジェクトを初期化する。
    - [ ] 必要なライブラリ（`wagmi`, `viem`, `rainbowkit`, `tailwindcss`, `shadcn/ui`）をインストールする。
    - [ ] `tailwind.config.js` と `globals.css` を設定する。
    - [ ] `shadcn/ui` の初期設定を行い、`components.json` を要件定義通りに設定する。
    - [ ] wagmi と RainbowKit の Provider を設定する。
    - [ ] `.env.example` を作成し、Next.jsで必要な環境変数を定義する。

---

## フェーズ2: スマートコントラクト開発 (Factory-Pair-Router構成)

- [ ] **2.1. ERC20トークンコントラクトの開発**
    - [ ] `TokenA.sol` と `TokenB.sol` を作成する (`TKA`, `TKB`)。
    - [ ] OpenZeppelinのERC20を継承して実装する。
    - [ ] `faucet` 機能を実装する（1日1回、100トークンを上限とする）。
    - [ ] `faucet` 機能を含む、ERC20トークンのユニットテストを作成する。
        - [ ] Hardhat Networkのタイムトラベル機能 (`evm_increaseTime`) を利用して、時間制限ロジックをテストする。

- [ ] **2.2. Factoryコントラクトの開発**
    - [ ] `DexFactory.sol` を作成する。
    - [ ] トークンペアを受け取り、対応する `DexPair` コントラクトをデプロイする `createPair` 関数を実装する。
    - [ ] 作成済みのペアアドレスを管理・参照する機能を実装する。
    - [ ] Factoryコントラクトのユニットテストを作成する。

- [ ] **2.3. Pairコントラクトの開発**
    - [ ] `DexPair.sol` を作成する（ERC20を継承し、LPトークンとして機能）。
    - [ ] 流動性プールとしてのコアロジック（`swap`, `mint`, `burn`）を実装する。これらはRouterからのみ呼び出されることを想定する。
    - [ ] 手数料（0.3%）を計算し、流動性提供者に分配するロジックを実装する。
    - [ ] `Swap`, `Mint`, `Burn` イベントを定義し、各関数で放出する。
    - [ ] Pairコントラクトのユニットテストを作成する（直接呼び出すのではなく、テスト用のヘルパーコントラクト経由でテストする）。

- [ ] **2.4. Routerコントラクトの開発**
    - [ ] `DexRouter.sol` を作成する。
    - [ ] ユーザーとの主要な窓口として、`addLiquidity`, `removeLiquidity`, `swapExactTokensForTokens` 等の関数を実装する。
    - [ ] Routerは内部でFactoryを呼び出してペアを探し、Pairコントラクトの関数を呼び出す。
    - [ ] リエントランシーガードを適用する。
    - [ ] Routerコントラクトの包括的なユニットテストを作成する（テストカバレッジ95%以上を目指す）。
        - [ ] 流動性提供のテスト
        - [ ] スワップ（正常系、異常系）のテスト
        - [ ] 流動性削除のテスト
        - [ ] 手数料計算のテスト

- [ ] **2.5. デプロイとスクリプト**
    - [ ] `hardhat-gas-reporter` を用いてガス効率を確認・最適化する。
    - [ ] `ignition` を用いて、全コントラクト（Factory, Router, Tokens）のデプロイスクリプトを作成する。
    - [ ] デプロイスクリプトを修正し、デプロイしたコントラクトのアドレス一覧をJSONファイルとしてフロントエンド側に自動で出力する。
    - [ ] `tasks` を用いて、主要なコントラクト関数を呼び出すタスクを作成する。

- [ ] **2.6. 最終デプロイ**
    - [ ] Sepoliaテストネットに全コントラクトをデプロイする。
    - [ ] 出力されたコントラクトアドレスのJSONファイルをフロントエンド側で参照できるようにする。

---

## フェーズ3: フロントエンド開発 (品質・保守性向上)

- [ ] **3.1. フロントエンド状態管理方針の決定**
    - [ ] UIの状態（モーダルの開閉など）やサーバーから取得したキャッシュデータの管理方法を検討する。
    - [ ] 必要に応じて、ZustandやJotaiのような軽量な状態管理ライブラリの導入を決定・設定する。

- [ ] **3.2. 共通コンポーネントの開発**
    - [ ] ヘッダーコンポーネントを作成する（ナビゲーションリンクを含む）。
    - [ ] RainbowKitを用いてウォレット接続ボタンを実装する。
    - [ ] トランザクションの状態（保留、成功、失敗）を通知するUIコンポーネントを実装する。
    - [ ] モバイル表示に対応する。

- [ ] **3.3. スワップ画面の開発**
    - [ ] スワップUI（トークン入力、数量入力、レート表示）を構築する。
    - [ ] ユーザーのトークン残高を表示する。
    - [ ] `viem` を使用して、Routerコントラクトの関数を呼び出し、スワップ結果をリアルタイムにプレビューする。
    - [ ] `wagmi` のフックを使用して、`approve` と Routerの `swap...` 関数のトランザクションを送信するロジックを実装する。
    - [ ] モバイル表示に対応する。

- [ ] **3.4. 流動性管理画面の開発**
    - [ ] 「追加」と「削除」を切り替えるタブUIを実装する。
    - [ ] **流動性追加:**
        - [ ] トークンペアと数量を入力するUIを構築する。
        - [ ] `approve` と Routerの `addLiquidity` のトランザクションを送信するロジックを実装する。
    - [ ] **流動性削除:**
        - [ ] ユーザーのLPトークン残高を表示する。
        - [ ] 削除するLPトークン量を入力するUIを構築する。
        - [ ] `approve` と Routerの `removeLiquidity` のトランザクションを送信するロジックを実装する。
    - [ ] モバイル表示に対応する。

- [ ] **3.5. 流動性ポジション表示画面の開発**
    - [ ] ユーザーが提供している流動性プールの一覧を表示するUIを構築する。
    - [ ] 各ポジションのトークンペア数量とLPトークン残高を表示する。
    - [ ] モバイル表示に対応する。

- [ ] **3.6. Faucet機能の実装**
    - [ ] テストトークンを取得するためのボタンをUI上のどこかに配置する。
    - [ ] ボタンクリックで `faucet` 関数を呼び出すロジックを実装する。

- [ ] **3.7. カスタムフックとユーティリティ**
    - [ ] コントラクトとのやり取りを抽象化するカスタムフックを作成する（例: `useSwap`, `useLiquidity`）。
    - [ ] 数値フォーマットやアドレスの短縮表示など、共通で利用するユーティリティ関数を作成する。

---

## フェーズ4: 統合・デプロイ (変更なし)

- [ ] **4.1. 統合テスト**
    - [ ] Sepoliaテストネットにデプロイしたコントラクトとフロントエンドを接続する。
    - [ ] 全ての機能を一通りテストし、意図通りに動作することを確認する（E2Eテスト）。

- [ ] **4.2. CI/CDの構築**
    - [ ] GitHub Actions等を利用し、CIパイプラインを構築する。
    - [ ] プルリクエスト時に、Biomeによるフォーマット・Lintチェックと、Hardhatのテストが自動実行されるように設定する。

- [ ] **4.3. フロントエンドのデプロイ**
    - [ ] VercelやNetlifyなどのホスティングサービスにフロントエンドアプリケーションをデプロイする。
    - [ ] 環境変数を正しく設定する。

- [ ] **4.4. READMEの更新**
    - [ ] プロジェクトの概要、セットアップ手順、デプロイされたURLなどを記載した最終的な`README.md`を作成する。
