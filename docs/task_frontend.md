# NFTマーケットプレイス フロントエンド開発タスクリスト (v2)

このドキュメントは、`docs/frontend_requirements.md` に基づいて、フロントエンドアプリケーションを完成させるために必要な開発タスクをステップごとにまとめたものです。レビューフィードバックを反映し、タスクの解像度を高めています。

---

## フェーズ1: プロジェクト基盤の構築

- [ ] **1.1. プロジェクトセットアップ:**
    - [ ] `pkgs/frontend` ディレクトリにNext.js (App Router) プロジェクトを初期化する。
    - [ ] `pnpm` を使用して、`package.json` に基づく全ての依存ライブラリ（`@tanstack/react-query` を含む）をインストールする。
    - [ ] `frontend.instructions.md` に従い、ディレクトリ構造（`app`, `components`, `hooks`, `lib`など）を作成する。
    - [ ] `.env.local` と `.env.example` ファイルを作成し、PrivyやBiconomyのAPIキーなどの環境変数を設定する。

- [ ] **1.2. スタイリングとUIのセットアップ:**
    - [ ] Tailwind CSS を設定する。
    - [ ] `shadcn/ui` を導入し、`components.json` を要件通りに設定する。
    - [ ] Biomeをセットアップし、フォーマットとリンティングのルールを適用する。

- [ ] **1.3. 共通レイアウトとコンポーネントの実装:**
    - [ ] 全ページで共通の `app/layout.tsx` を作成する。
    - [ ] 共通ヘッダーコンポーネントを実装する（ロゴ、ナビゲーション、検索バー、ログインボタン）。
    - [ ] 共通フッターコンポーネントを実装する（サイトマップ、ソーシャルリンク、コピーライト）。

- [ ] **1.4. Web3インテグレーションの基盤実装:**
    - [ ] **状態管理の設計:**
        - [ ] ユーザー認証状態、スマートアカウント情報などはグローバルな状態管理（Zustand/Jotai）の方針を決定する。
        - [ ] コントラクトからのデータ取得など、非同期データは `TanStack Query` を用いて管理する方針を固める。
    - [ ] アプリケーション全体をラップするプロバイダー (`PrivyProvider`, `QueryClientProvider`) を設定する。
    - [ ] ヘッダーにPrivyのログイン・ログアウト機能を実装し、認証状態をグローバルストアで管理する。
    - [ ] `hooks/useBiconomy.ts` を実装する。**（※テスト容易性を考慮し、依存性の注入が可能な設計にすること）**

---

## フェーズ2: 主要機能の実装

- [ ] **2.1. NFT一覧・詳細ページの開発:**
    - [ ] 個々のNFTを表示するためのカードコンポーネント (`NFTCard`) と、データ取得中のローディングスケルトンUIを作成する。
    - [ ] **トップページ (`/`) のデータ取得ロジック実装:**
        - [ ] a. `NFTMarketplace`から出品中の`tokenId`リストを取得する。
        - [ ] b. 取得した`tokenId`リストを元に、`NFTContract`から`tokenURI`を並行して取得する。
        - [ ] c. 取得した`tokenURI`を元に、IPFSからメタデータ（画像、名前）を並行して取得する。
        - [ ] d. 上記情報を結合し、`TanStack Query`でキャッシュ管理するカスタムフックを実装する。
    - [ ] トップページUIを実装し、カスタムフックから取得したデータを表示する。
    - [ ] NFT詳細ページ (`/nft/[tokenId]`) を作成し、同様に複数のソースからデータを結合して表示するロジックを実装する。

- [ ] **2.2. NFT作成機能の開発:**
    - [ ] NFT作成ページ (`/create`) のUIを実装する（画像アップロード、フォーム入力）。
    - [ ] IPFSへの画像・メタデータアップロード処理を実装する（`Pinata` や `NFT.Storage` のSDKを利用）。
    - [ ] フォーム入力値とIPFSのURIから `mintNFT` 関数のコールデータを生成し、`useBiconomy` フック経由でトランザクションを実行するロジックを実装する。

- [ ] **2.3. NFT取引機能の実装:**
    - [ ] NFT詳細ページに「購入する」ボタンを実装し、クリック時に `buyNFT` を実行するロジックを実装する。
    - [ ] NFT詳細ページに「オファーする」ボタンと金額入力モーダルを実装し、`makeOffer` を実行するロジックを実装する。

- [ ] **2.4. マイページの開発:**
    - [ ] マイページ (`/my-page`) の基本的なレイアウトとタブUIを実装する。
    - [ ] 各タブ（所有NFT、出品中NFTなど）で表示するデータを取得するための、複数のコントラクトを組み合わせたデータ取得フックをそれぞれ実装する。
    - [ ] 各タブのUIを実装し、データ取得フックと連携させる。
    - [ ] プロフィール編集機能を実装し、Privyのメタデータ等に保存する。

---

## フェーズ3: 機能の連携とUX向上

- [ ] **3.1. マイページからのアクション実装:**
    - [ ] 「所有NFT」タブからNFTを出品 (`listNFT`) する機能を実装する。
    - [ ] 「出品中NFT」タブから出品をキャンセル (`cancelListing`) する機能を実装する。
    - [ ] 「出品中NFT」タブから出品価格を変更（キャンセル→再出品）する機能を実装する。
    - [ ] 「受けたオファー」タブからオファーを承諾 (`acceptOffer`) する機能を実装する。

- [ ] **3.2. トランザクションフィードバックの強化:**
    - [ ] トランザクションの送信、成功、失敗をユーザーに知らせるためのトースト通知システムを実装する。
    - [ ] マイページの取引履歴に「処理中」などのステータスを表示するUIを実装する。

- [ ] **3.3. 検索・フィルタリング機能の実装:**
    - [ ] ヘッダーの検索バーを実装し、入力されたキーワードに基づいてNFTを検索する機能を実装する。
    - [ ] NFT一覧ページに、価格や作成日時で並び替えるソート機能を実装する。

- [ ] **3.4. PWA対応:**
    - [ ] `public` ディレクトリにマニフェストファイルやアイコンを配置し、PWAとしてインストール可能にする。

- [ ] **3.5. 包括的なエラーハンドリング実装:**
    - [ ] `viem`が返すコントラクトのrevert理由をパースし、分かりやすいメッセージに変換するユーティリティ関数を作成する。
    - [ ] ユーザーがPrivyでの署名を拒否した場合の処理を実装する。
    - [ ] トランザクションがタイムアウトした場合の処理を実装する。
    - [ ] IPFSからメタデータを取得できなかった場合のフォールバックUI（代替画像の表示など）を実装する。

---

## フェーズ4: テストと最終調整

- [ ] **4.1. テストの実施:**
    - [ ] `Vitest` と `React Testing Library` を用いて、主要なコンポーネントとカスタムフックの単体テストを作成する。（※モックを注入できる設計を活かす）
    - [ ] ユーザーの主要な操作（ログイン→NFT作成→出品→購入）を一通り実行するE2Eテストのシナリオを作成し、手動または自動でテストする。

- [ ] **4.2. レスポンシブ対応の最終確認:**
    - [ ] PC、タブレット、スマートフォンなど、異なるデバイス幅で全てのページの表示が崩れないか最終確認と調整を行う。

- [ ] **4.3. デプロイ準備:**
    - [ ] VercelやNetlifyなどのホスティングサービスへのデプロイ手順を確立する。
    - [ ] 本番環境用の環境変数が正しく設定されていることを確認する。
