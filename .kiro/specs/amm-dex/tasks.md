# AMM DEX 実装タスクリスト

## 概要

このタスクリストは、AMM DEX の段階的な実装を行うためのコーディングタスクです。各タスクは前のタスクの成果物を基に構築され、テスト駆動開発を重視した実装を行います。

## 実装タスク

- [x] 1. プロジェクト基盤セットアップ
  - モノレポ構造の構築とパッケージ設定
  - 開発環境とツールチェーンの設定
  - 基本的なディレクトリ構造の作成
  - _要件: 1.1, 2.1, 3.1_

- [x] 1.1 Hardhat プロジェクトセットアップ
  - Hardhat 設定ファイルの作成と Sepolia 設定
  - 必要な依存関係のインストール（OpenZeppelin、TypeChain 等）
  - テスト環境とデプロイスクリプトの基本構造作成
  - _要件: 2.1, 3.1_

- [x] 1.2 Next.js フロントエンドプロジェクトセットアップ
  - Next.js 14 App Router プロジェクトの初期化
  - TailwindCSS、TypeScript、ESLint の設定
  - 基本的なディレクトリ構造とファイル作成
  - _要件: 1.1, 3.1_

- [x] 2. コアスマートコントラクト実装
  - AMM Factory、Pair、Router コントラクトの実装
  - 基本的な流動性プール機能の実装
  - コントラクト間の連携機能実装
  - _要件: 2.1, 2.2_

- [x] 2.1 AMMPair コントラクト実装
  - ERC20 ベースの LP トークン機能実装
  - mint/burn 関数による流動性管理実装
  - swap 関数によるトークン交換機能実装
  - getReserves 関数による残高取得機能実装
  - _要件: 2.1, 2.2_

- [x] 2.2 AMMFactory コントラクト実装
  - ペア作成機能（createPair）の実装
  - ペア管理とアドレス取得機能の実装
  - イベント発行による透明性確保
  - _要件: 2.1, 2.2_

- [x] 2.3 AMMRouter コントラクト実装
  - swapExactTokensForTokens 関数の実装
  - addLiquidity/removeLiquidity 関数の実装
  - 価格計算とスリッページ保護機能の実装
  - デッドライン機能による時間制限実装
  - _要件: 1.1, 1.2, 2.1, 2.2_

- [x] 3. スマートコントラクトテスト実装
  - 各コントラクトの包括的なユニットテスト作成
  - 統合テストによるコントラクト間連携検証
  - エッジケースとエラーハンドリングのテスト
  - _要件: 5.1, 5.2_

- [x] 3.1 AMMPair コントラクトテスト
  - 流動性追加・削除のテストケース作成
  - スワップ機能の正確性テスト
  - エラーケース（不正な入力値等）のテスト
  - _要件: 5.1, 5.2_

- [x] 3.2 AMMRouter コントラクトテスト
  - スワップ機能の包括的テスト（正常系・異常系）
  - 流動性管理機能のテスト
  - スリッページ保護とデッドライン機能のテスト
  - _要件: 1.1, 1.2, 5.1, 5.2_

- [ ] 4. Web3 設定とプロバイダー実装
  - Wagmi 設定と Sepolia ネットワーク接続
  - RainbowKit 統合とウォレット接続機能
  - コントラクト ABI 定義と TypeScript 型生成
  - _要件: 3.1, 3.2_

- [ ] 4.1 Wagmi 設定とプロバイダー実装
  - createConfig による Wagmi 設定作成
  - Sepolia チェーン設定と RPC 接続設定
  - WagmiProvider と QueryClientProvider の実装
  - _要件: 3.1, 3.2_

- [ ] 4.2 RainbowKit 統合実装
  - RainbowKitProvider の設定と実装
  - カスタムウォレット接続ボタンの作成
  - ウォレット状態管理とエラーハンドリング
  - _要件: 3.1, 3.2_

- [ ] 5. 基本 UI コンポーネント実装
  - 共通 UI コンポーネント（Button、Input、Modal 等）の作成
  - レイアウトコンポーネント（Header、Footer）の実装
  - トークン選択コンポーネントの実装
  - _要件: 1.1, 3.1, 4.1_- [ ] 5.1
    共通 UI コンポーネント実装
  - Button、Input、Card、Modal コンポーネントの作成
  - TailwindCSS を使用したレスポンシブデザイン実装
  - TypeScript による型安全な props 定義
  - _要件: 4.1, 5.1_

- [ ] 5.2 ヘッダーコンポーネント実装
  - ナビゲーションメニューの実装
  - ConnectWallet ボタンとアカウントドロップダウンの実装
  - ネットワーク切り替え機能の実装
  - _要件: 3.1, 3.2, 4.1_

- [ ] 5.3 トークン選択コンポーネント実装
  - サポートトークン一覧表示機能
  - トークン検索とフィルタリング機能
  - 残高表示とトークン選択機能
  - _要件: 1.1, 3.1, 4.1_

- [ ] 6. コントラクトインタラクション実装
  - カスタムフック（useSwap、usePools 等）の実装
  - コントラクト読み取り・書き込み機能の実装
  - トランザクション状態管理とエラーハンドリング
  - _要件: 1.1, 1.2, 2.1, 2.2_

- [ ] 6.1 useSwap フック実装
  - スワップクォート計算機能の実装
  - swapExactTokensForTokens 実行機能の実装
  - トランザクション状態とエラー管理
  - _要件: 1.1, 1.2, 5.1_

- [ ] 6.2 usePools フック実装
  - プール情報取得機能（getReserves 等）の実装
  - 流動性追加・削除機能の実装
  - LP トークン残高管理機能の実装
  - _要件: 2.1, 2.2, 4.1_

- [ ] 6.3 useTokens フック実装
  - ERC20 トークン残高取得機能の実装
  - トークン承認（approve）機能の実装
  - 複数トークンの一括残高取得機能
  - _要件: 1.1, 3.1, 4.1_

- [ ] 7. スワップ機能実装
  - スワップインターフェースの実装
  - 価格計算とスリッページ設定機能
  - トークン承認とスワップ実行機能
  - _要件: 1.1, 1.2, 5.1_

- [ ] 7.1 SwapCard コンポーネント実装
  - トークン入力フィールドとトークン選択機能
  - スワップ方向切り替え機能の実装
  - 価格表示とスリッページ設定 UI
  - _要件: 1.1, 1.2, 4.1_

- [ ] 7.2 価格計算ロジック実装
  - AMM 価格計算アルゴリズムの実装
  - 価格影響とスリッページ計算機能
  - 最小受取数量計算機能
  - _要件: 1.1, 1.2, 4.1_

- [ ] 7.3 スワップ実行機能実装
  - トークン承認フローの実装
  - スワップトランザクション実行機能
  - 成功・失敗時の適切なフィードバック表示
  - _要件: 1.1, 1.2, 5.1_

- [ ] 8. 流動性プール機能実装
  - プール一覧表示機能の実装
  - 流動性追加・削除インターフェースの実装
  - LP トークン管理機能の実装
  - _要件: 2.1, 2.2, 4.1_

- [ ] 8.1 プール一覧ページ実装
  - アクティブプール一覧表示機能
  - プール統計情報（TVL、APY 等）表示
  - プール詳細ページへのナビゲーション
  - _要件: 2.1, 4.1_

- [ ] 8.2 流動性追加機能実装
  - AddLiquidity コンポーネントの実装
  - トークンペア選択と数量入力機能
  - 流動性追加トランザクション実行機能
  - _要件: 2.1, 2.2, 5.1_

- [ ] 8.3 流動性削除機能実装
  - RemoveLiquidity コンポーネントの実装
  - LP トークン残高表示と削除数量選択
  - 流動性削除トランザクション実行機能
  - _要件: 2.1, 2.2, 5.1_

- [ ] 9. 状態管理とデータフロー実装
  - Zustand 状態管理の実装
  - リアルタイムデータ更新機能
  - ローカルストレージ連携機能
  - _要件: 1.1, 2.1, 4.1_

- [ ] 9.1 グローバル状態管理実装
  - Zustand ストアの設計と実装
  - トークン選択状態とスリッページ設定管理
  - プール情報とユーザー設定の永続化
  - _要件: 1.1, 4.1_

- [ ] 9.2 リアルタイムデータ更新実装
  - ブロック更新に基づく自動データ更新
  - WebSocket 接続による即座な価格更新
  - 効率的なポーリング戦略の実装
  - _要件: 4.1, 4.2_

- [ ] 10. エラーハンドリングと UX 改善
  - 包括的なエラーハンドリング実装
  - ローディング状態とトランザクション進行表示
  - ユーザーフレンドリーなエラーメッセージ
  - _要件: 5.1, 5.2_

- [ ] 10.1 エラーハンドリング実装
  - カスタムエラークラスとエラー分類
  - コントラクトエラーの適切な解釈と表示
  - ネットワークエラーとリトライ機能
  - _要件: 5.1, 5.2_

- [ ] 10.2 UX 改善実装
  - ローディングスピナーとスケルトン UI
  - トランザクション進行状況の可視化
  - 成功・失敗時の適切なフィードバック
  - _要件: 5.1, 5.2_

- [ ] 11. テストとデバッグ
  - フロントエンドコンポーネントのテスト実装
  - E2E テストによる完全なユーザーフロー検証
  - パフォーマンステストと最適化
  - _要件: 5.1, 5.2_

- [ ] 11.1 コンポーネントテスト実装
  - React Testing Library を使用したユニットテスト
  - カスタムフックのテスト実装
  - モックを使用したコントラクトインタラクションテスト
  - _要件: 5.1, 5.2_

- [ ] 11.2 E2E テスト実装
  - Playwright を使用した完全なユーザーフローテスト
  - ウォレット接続からスワップ・流動性管理までのテスト
  - 異なるブラウザとデバイスでの動作確認
  - _要件: 5.1, 5.2_

- [ ] 12. デプロイメントと最終統合
  - スマートコントラクトの Sepolia デプロイ
  - フロントエンドの Vercel デプロイ
  - 本番環境での動作確認と最終調整
  - _要件: 全要件_

- [ ] 12.1 スマートコントラクトデプロイ
  - Sepolia ネットワークへのコントラクトデプロイ
  - コントラクトアドレスの設定ファイル更新
  - Etherscan でのコントラクト検証
  - _要件: 2.1, 2.2_

- [ ] 12.2 フロントエンドデプロイ
  - 本番環境用の環境変数設定
  - Vercel へのデプロイとドメイン設定
  - パフォーマンス監視とエラートラッキング設定
  - _要件: 全要件_

## 実装順序の重要性

各タスクは前のタスクの成果物に依存しているため、順序通りに実装することが重要です：

1. **基盤構築** (タスク 1-2): プロジェクト構造とコアコントラクト
2. **テスト実装** (タスク 3): 品質保証の基盤
3. **Web3 統合** (タスク 4): ブロックチェーン接続
4. **UI 基盤** (タスク 5): ユーザーインターフェース
5. **機能実装** (タスク 6-8): コア機能の段階的実装
6. **品質向上** (タスク 9-11): UX とテスト
7. **デプロイ** (タスク 12): 本番環境への展開

各タスクは独立してテスト可能で、段階的に機能を追加していく設計になっています。
