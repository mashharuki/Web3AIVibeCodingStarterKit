# AMM DEX 要件定義書

## はじめに

本文書は、UniswapライクなAMM（Automated Market Maker）DEX（Decentralized Exchange）の要件定義書です。このDEXは検証用途として開発され、Ethereum Sepoliaテストネット上で動作します。UNCHAINの学習コンテンツ（AVAX-AMM）と同等の機能を提供し、Web3初心者から上級者まで利用できるユーザーフレンドリーなインターフェースを目指します。

## 要件

### 要件1: ウォレット接続機能

**ユーザーストーリー:** Web3ユーザーとして、MetaMaskなどのウォレットを接続して、安全にDEXを利用したい

#### 受け入れ基準

1. WHEN ユーザーが「ウォレット接続」ボタンをクリック THEN システム SHALL MetaMaskなどの対応ウォレットの接続ダイアログを表示する
2. WHEN ウォレットが正常に接続された THEN システム SHALL ユーザーのアドレスと残高を画面に表示する
3. WHEN ユーザーが間違ったネットワーク（Sepolia以外）に接続している THEN システム SHALL ネットワーク切り替えを促すメッセージを表示する
4. WHEN ウォレット接続が失敗した THEN システム SHALL エラーメッセージを表示し、再試行オプションを提供する

### 要件2: トークンスワップ機能

**ユーザーストーリー:** DEXユーザーとして、異なるERC-20トークン間で効率的にスワップ取引を行いたい

#### 受け入れ基準

1. WHEN ユーザーがスワップ元トークンと数量を選択 THEN システム SHALL リアルタイムでスワップ先トークンの受取予想数量を計算・表示する
2. WHEN ユーザーがスワップを実行 THEN システム SHALL トランザクションを送信し、進行状況を表示する
3. WHEN 流動性が不足している THEN システム SHALL 「流動性不足」エラーメッセージを表示する
4. WHEN スリッページが設定値を超える THEN システム SHALL 警告メッセージを表示し、ユーザーの確認を求める
5. WHEN トークンの承認（Approve）が必要 THEN システム SHALL 承認トランザクションを先に実行するよう促す

### 要件3: 流動性提供機能

**ユーザーストーリー:** 流動性プロバイダーとして、トークンペアに流動性を提供して手数料収入を得たい

#### 受け入れ基準

1. WHEN ユーザーが流動性提供画面にアクセス THEN システム SHALL 利用可能なトークンペア一覧を表示する
2. WHEN ユーザーが2つのトークンと数量を入力 THEN システム SHALL 現在の価格比率に基づいて適切な比率を自動計算・表示する
3. WHEN ユーザーが流動性を提供 THEN システム SHALL LPトークンを発行し、ユーザーのウォレットに送信する
4. WHEN ユーザーが流動性を除去 THEN システム SHALL LPトークンを燃焼し、対応するトークンペアを返還する
5. WHEN 新しいトークンペアを作成 THEN システム SHALL 初期価格比率の設定をユーザーに求める

### 要件4: 流動性プール管理機能

**ユーザーストーリー:** DEXユーザーとして、各流動性プールの詳細情報を確認し、投資判断を行いたい

#### 受け入れ基準

1. WHEN ユーザーがプール一覧画面にアクセス THEN システム SHALL 全プールのTVL、APR、取引量を表示する
2. WHEN ユーザーが特定のプールを選択 THEN システム SHALL プールの詳細情報（価格チャート、流動性履歴、手数料収益）を表示する
3. WHEN プールの統計情報を表示 THEN システム SHALL 24時間取引量、7日間平均APR、流動性プロバイダー数を含める
4. WHEN ユーザーが自分の流動性ポジションを確認 THEN システム SHALL 提供中の流動性、未請求手数料、損益を表示する

### 要件5: 価格表示・チャート機能

**ユーザーストーリー:** トレーダーとして、リアルタイムの価格情報とチャートを確認して取引判断を行いたい

#### 受け入れ基準

1. WHEN ユーザーがトークンペアを選択 THEN システム SHALL リアルタイムの価格情報を表示する
2. WHEN 価格チャートを表示 THEN システム SHALL 1時間、24時間、7日間、30日間の時間軸オプションを提供する
3. WHEN 価格が大幅に変動 THEN システム SHALL 変動率をパーセンテージで表示する
4. WHEN 取引量データを表示 THEN システム SHALL 指定期間の累計取引量と平均取引サイズを表示する

### 要件6: トランザクション履歴機能

**ユーザーストーリー:** DEXユーザーとして、自分の取引履歴を確認し、税務申告や資産管理に活用したい

#### 受け入れ基準

1. WHEN ユーザーが履歴画面にアクセス THEN システム SHALL ユーザーの全取引履歴を時系列で表示する
2. WHEN 取引履歴を表示 THEN システム SHALL 取引タイプ（スワップ、流動性提供/除去）、金額、手数料、タイムスタンプを含める
3. WHEN ユーザーが履歴をフィルタリング THEN システム SHALL 日付範囲、取引タイプ、トークンによる絞り込み機能を提供する
4. WHEN 取引詳細を確認 THEN システム SHALL トランザクションハッシュ、ブロック番号、ガス使用量を表示する
5. WHEN 履歴をエクスポート THEN システム SHALL CSV形式でのダウンロード機能を提供する

### 要件7: ユーザーインターフェース・体験

**ユーザーストーリー:** Web3初心者として、直感的で使いやすいインターフェースでDEXを利用したい

#### 受け入れ基準

1. WHEN ユーザーがサイトにアクセス THEN システム SHALL レスポンシブデザインでモバイル・デスクトップ両方に対応する
2. WHEN 複雑な操作を実行 THEN システム SHALL ステップバイステップのガイダンスを提供する
3. WHEN エラーが発生 THEN システム SHALL 分かりやすいエラーメッセージと解決方法を表示する
4. WHEN 長時間の処理を実行 THEN システム SHALL プログレスバーまたはローディングアニメーションを表示する
5. WHEN 重要な操作を実行 THEN システム SHALL 確認ダイアログで操作内容と手数料を表示する

### 要件8: セキュリティ・安全性

**ユーザーストーリー:** DEXユーザーとして、資産を安全に管理し、セキュリティリスクを最小限に抑えたい

#### 受け入れ基準

1. WHEN スマートコントラクトを実装 THEN システム SHALL OpenZeppelinライブラリを使用してセキュリティベストプラクティスに従う
2. WHEN ユーザーが大額取引を実行 THEN システム SHALL 取引内容の最終確認を求める
3. WHEN 異常な価格変動を検出 THEN システム SHALL 警告メッセージを表示する
4. WHEN フロントエンドでトランザクションを構築 THEN システム SHALL 入力値の検証とサニタイゼーションを実行する
5. WHEN 秘密鍵や機密情報を扱う THEN システム SHALL クライアントサイドでのみ処理し、サーバーに送信しない

### 要件9: パフォーマンス・スケーラビリティ

**ユーザーストーリー:** DEXユーザーとして、高速で安定したサービスを利用したい

#### 受け入れ基準

1. WHEN ページを読み込み THEN システム SHALL 2秒以内に初期表示を完了する
2. WHEN 価格情報を更新 THEN システム SHALL 5秒間隔でリアルタイム更新を実行する
3. WHEN 大量のプールデータを表示 THEN システム SHALL 仮想スクロールまたはページネーションを実装する
4. WHEN スマートコントラクトを実装 THEN システム SHALL ガス効率を最適化し、取引コストを最小化する
5. WHEN 同時アクセス数が増加 THEN システム SHALL パフォーマンスの劣化なく処理を継続する